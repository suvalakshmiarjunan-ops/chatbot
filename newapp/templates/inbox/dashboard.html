{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Inbox</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --sidebar-w: 240px;
      --list-w: 280px;
      --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --fill:#f8fafc;
      --blue:#0d6efd; --bubble-bot:#eef2ff; --bubble-user:#e6f4ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink)}
    .app{display:flex; min-height:100vh}

    /* left sidebar include */
    .sidebar-wrap{width:var(--sidebar-w); border-right:1px solid var(--line); background:#fff}

    /* middle: list of conversations */
    .list{
      width:var(--list-w);
      border-right:1px solid var(--line);
      background:#fff;
      display:flex; flex-direction:column;
    }
    .list-head{padding:12px 14px; font-weight:700; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:8px}
    .items{overflow:auto}
    .item{
      display:grid; grid-template-columns:40px 1fr auto; gap:10px;
      padding:12px 14px; border-bottom:1px solid #f1f5f9; text-decoration:none; color:inherit;
    }
    .item:hover{background:#f8fafc}
    .item.active{background:#eef6ff}
    .avatar{
      width:40px;height:40px;border-radius:50%;background:#e2e8f0;display:grid;place-items:center;font-weight:700;color:#334155;
    }
    .name{font-weight:600}
    .preview{font-size:13px;color:var(--muted);white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .time{font-size:12px;color:var(--muted)}

    /* right: chat thread */
    .thread{flex:1; display:flex; flex-direction:column; min-width:0; background:#fff}
    .thread-head{padding:12px 16px; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:10px}
    .thread-body{flex:1; overflow:auto; background:var(--fill); padding:18px}
    .rowmsg{display:flex; margin:10px 0}
    .rowmsg.bot{justify-content:flex-start}
    .rowmsg.user{justify-content:flex-end}
    .bubble{
      max-width:min(70%, 560px);
      padding:10px 12px; border-radius:16px; font-size:14px; line-height:1.35;
      box-shadow:0 1px 1px rgba(0,0,0,.04);
    }
    .bot .bubble{background:var(--bubble-bot)}
    .user .bubble{background:var(--bubble-user)}
    .meta{font-size:11px; color:var(--muted); margin-top:4px}
    .empty{color:var(--muted); text-align:center; margin-top:24px}
  </style>
</head>
<body>
<div class="app">

  <!-- Sidebar (your component) -->
  <aside class="sidebar-wrap">
    {% include 'layouts/sidebar.html' %}
  </aside>

  <!-- Conversation list -->
  <section class="list">
    <div class="list-head">Inbox</div>
    <div class="items">
      {% for u in users %}
        
        <a class="item {% if is_active %}active{% endif %}"
           href="{% url 'inbox_dashboard' %}?user_id={{ u.id }}">
          <div class="avatar">{{ u.name|default:u.phone_no|slice:":2"|upper }}</div>
          <div>
            <div class="name">{{ u.name|default:"User" }}</div>
            <div class="preview">{{ u.phone_no }}</div>
          </div>
          <div class="time">
            {% if is_active and messages|length %}
              
            {% endif %}
          </div>
        </a>
        
      {% empty %}
        <div class="p-3 text-muted">No users.</div>
      {% endfor %}
    </div>
  </section>

  <!-- Thread -->
  <section class="thread">
    <div class="thread-head">
      {% if selected_user %}
        <div class="avatar" style="width:36px;height:36px">{{ selected_user.name|default:selected_user.phone_no|slice:":2"|upper }}</div>
        <div>
          <div style="font-weight:700">{{ selected_user.name|default:"User" }}</div>
          <div class="text-muted" style="font-size:12px">{{ selected_user.phone_no }}</div>
        </div>
      {% else %}
        <div style="font-weight:700">Select a conversation</div>
      {% endif %}
    </div>

    <div class="thread-body" id="threadBody">
      {% if messages %}
        {% for m in messages %}
          <div class="rowmsg {% if m.who == 'bot' %}bot{% else %}user{% endif %}">
            <div class="bubble">
              <div>{{ m.messages }}</div>
              <div class="meta">{{ m.created_at|date:"H:i" }}</div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty">No messages for this user.</div>
      {% endif %}
    </div>

    <!-- VIEW-ONLY: no input/footer -->
  </section>

</div>

<script>
  // Auto-scroll to latest message
  (function(){var el=document.getElementById('threadBody'); if(el) el.scrollTop=el.scrollHeight;})();
</script>
</body>
</html>
