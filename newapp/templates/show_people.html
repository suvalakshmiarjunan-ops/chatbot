{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Chatbox</title>

  <!-- Optional: Bootstrap for quick defaults -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --sidebar-w: 300px;
      --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --fill:#f9fafb; --card:#ffffff;
      --bot:#eef2ff; --user:#dcfce7; --active:#0d6efd;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#f7f8fb;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;color:var(--ink)}
    .wrap{display:flex; min-height:100vh}

    /* left list */
    .users{
      width:var(--sidebar-w); background:#fff; border-right:1px solid var(--line);
      padding:14px; overflow:auto;
    }
    .users .title{font-weight:700; font-size:18px; margin:2px 0 12px}
    .user-item{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; text-decoration:none; color:inherit;}
    .user-item:hover{background:#f3f4f6}
    .user-item.active{background:rgba(13,110,253,.12); outline:1px solid #d6e4ff}
    .avatar{
      width:36px;height:36px;border-radius:50%;background:#e5e7eb;display:grid;place-items:center;font-weight:700;color:#444;
      flex:0 0 36px;
    }
    .u-meta{display:flex;flex-direction:column}
    .u-name{font-weight:600}
    .u-phone{font-size:12px; color:var(--muted)}

    /* right panel */
    .chat{
      flex:1; display:flex; flex-direction:column; min-width:0;
    }
    .chat-head{
      background:#fff; border-bottom:1px solid var(--line); padding:12px 16px; display:flex; align-items:center; gap:10px;
    }
    .chat-body{
      flex:1; overflow:auto; padding:18px; background:var(--fill);
    }
    .rowmsg{display:flex; margin-bottom:10px; gap:8px}
    .rowmsg.bot{justify-content:flex-start}
    .rowmsg.user{justify-content:flex-end}
    .msg{
      max-width:min(70%, 560px);
      padding:10px 12px; border-radius:12px; background:#fff; box-shadow:0 1px 1px rgba(0,0,0,.04);
      font-size:14px; line-height:1.35;
    }
    .bot .msg{background:var(--bot)}
    .user .msg{background:var(--user)}
    .meta{font-size:11px; color:var(--muted); margin-top:4px}
    .chat-foot{
      background:#fff; border-top:1px solid var(--line); padding:12px 16px; display:flex; gap:8px;
    }
    textarea.form-control{resize:none; height:44px}
    .empty{color:var(--muted); text-align:center; margin-top:24px}
    .badge-active{
      display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; margin-left:auto;
    }
  </style>
</head>
<body>
<div class="wrap">
    {% load static %}
    {% include 'layouts/sidebar.html' %}
  <!-- Users list -->
  <aside class="users">
    <div class="title">Contacts</div>
    {% for u in users %}
     
      <a class="user-item {% if is_active %}active{% endif %}"
         href="{% url 'chatbox' %}?user_id={{ u.id }}">
        <div class="avatar">{{ u.name|default:u.phone_no|slice:":2"|upper }}</div>
        <div class="u-meta">
          <div class="u-name">{{ u.name|default:"User " }}{{ u.id }}</div>
          <div class="u-phone">{{ u.phone_no }}</div>
        </div>
        {% if is_active %}<span class="badge-active">Active</span>{% endif %}
      </a>
      
    {% empty %}
      <div class="empty">No users yet.</div>
    {% endfor %}
  </aside>

  <!-- Chat panel -->
  <section class="chat">
    <header class="chat-head">
      {% if selected_user %}
        <div class="avatar">{{ selected_user.name|default:selected_user.phone_no|slice:":2"|upper }}</div>
        <div>
          <div style="font-weight:700">{{ selected_user.name|default:"User " }}{{ selected_user.id }}</div>
          <div class="u-phone">{{ selected_user.phone_no }}</div>
        </div>
      {% else %}
        <div style="font-weight:700">Select a contact to view messages</div>
      {% endif %}
    </header>

    <div class="chat-body" id="chatBody">
      {% if messages %}
        {% for m in messages %}
          <div class="rowmsg {% if m.who == 'bot' %}bot{% else %}user{% endif %}">
            <div class="msg">
              <div>{{ m.messages }}</div>
              <div class="meta">
                {{ m.created_at|date:"Y-m-d H:i" }} • {{ m.who|default:"user" }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty">No messages for this user.</div>
      {% endif %}
    </div>

    <!-- Optional send form (wire to your endpoint if needed)
    <form class="chat-foot" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="user_id" value="{{ selected_user.id|default:'' }}">
      <textarea class="form-control" name="text" placeholder="Type a message…" {% if not selected_user %}disabled{% endif %}></textarea>
      <button class="btn btn-primary" {% if not selected_user %}disabled{% endif %}>Send</button>
    </form> -->
  </section>

</div>

<script>
  // auto-scroll to latest
  (function(){ var el = document.getElementById('chatBody'); if(el) el.scrollTop = el.scrollHeight; })();
</script>
</body>
</html>
